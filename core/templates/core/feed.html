{% extends 'core/base.html' %}

{% block title %}Your Feed{% endblock %}

{% block content %}
<h3>Your Feed</h3>

{% for post in posts %}
<div class="card my-3">
  <div class="card-body">
    <h5>{{ post.author.username }}</h5>
    {% if post.image %}
      <img src="{{ post.image.url }}" class="img-fluid rounded mb-2">
    {% endif %}
    <p>{{ post.caption }}</p>

    <!-- Like Button -->
    <form action="{% url 'like_post' post.id %}" method="POST">
      {% csrf_token %}
      <button type="submit" class="btn btn-outline-primary">
        ❤️ {{ post.total_likes }} Like{{ post.total_likes|pluralize }}
      </button>
    </form>

    <!-- Comments Section -->
    <div class="mt-3">
      <h6>Comments</h6>
      <ul class="list-group list-group-flush mb-2">
        {% for comment in post.comments.all %}
          <li class="list-group-item">
            <strong>{{ comment.user.username }}:</strong> {{ comment.text }}
          </li>
        {% empty %}
          <li class="list-group-item text-muted">No comments yet.</li>
        {% endfor %}
      </ul>

      <form action="{% url 'add_comment' post.id %}" method="POST">
        {% csrf_token %}
        <div class="input-group">
          <textarea name="text" class="form-control" placeholder="Add a comment..." required></textarea>
          <button type="submit" class="btn btn-primary">Comment</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% empty %}
<p>No posts yet.</p>
{% endfor %}

{% endblock %}
