{% extends 'core/base.html' %}
{% block title %}Search{% endblock %}

{% block content %}
<div class="mb-4">
  <h3>Search Results for "{{ query }}"</h3>
  <hr>
</div>

<!-- Users -->
<div class="mb-4">
  <h5>Users</h5>
  {% if users %}
    <div class="list-group">
      {% for u in users %}
        <a href="{% url 'profile' u.username %}" class="list-group-item list-group-item-action d-flex align-items-center">
          {% if u.profile_image %}
            <img src="{{ u.profile_image.url }}" alt="{{ u.username }}" class="rounded-circle me-2" style="width:40px; height:40px;">
          {% else %}
            <div class="rounded-circle bg-secondary text-white d-flex justify-content-center align-items-center me-2" style="width:40px; height:40px;">
              {{ u.username|slice:":1"|upper }}
            </div>
          {% endif %}
          <span>{{ u.username }}</span>
        </a>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-muted">No users found.</p>
  {% endif %}
</div>

<!-- Posts -->
<div class="mb-4">
  <h5>Posts</h5>
  {% if posts %}
    <div class="row">
      {% for post in posts %}
        <div class="col-md-4 mb-3">
          <div class="card shadow-sm">
            {% if post.image %}
              <img src="{{ post.image.url }}" class="card-img-top" alt="Post image">
            {% endif %}
            <div class="card-body p-2">
              <p class="small mb-1">
                <strong>{{ post.author.username }}</strong>
              </p>
              <p class="card-text small">{{ post.caption|truncatewords:15 }}</p>
              <a href="{% url 'post_detail' post.id %}" class="btn btn-sm btn-outline-primary">View</a>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-muted">No posts found.</p>
  {% endif %}
</div>

<script>
const searchForm = document.querySelector('.search-form');
searchForm?.addEventListener('submit', function(e){
    const input = this.querySelector('input[name="q"]');
    if (!input.value.trim()) {
        e.preventDefault();
        alert("Please enter a search term.");
    }
});
</script>
{% endblock %}
