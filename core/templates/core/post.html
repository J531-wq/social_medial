{% extends 'core/base.html' %}

{% block title %}Post Details{% endblock %}

{% block content %}
<div class="card my-4 shadow-sm">
  <div class="card-body">
    <h5 class="card-title">
      <a href="{% url 'profile' post.author.username %}" class="text-decoration-none">
        {{ post.author.username }}
      </a>
    </h5>

    {% if post.image %}
      <img src="{{ post.image.url }}" class="img-fluid rounded mb-3" alt="Post image">
    {% endif %}

    <p class="card-text">{{ post.caption }}</p>
    <p class="text-muted small mb-2">
      Posted on {{ post.created_at|date:"F j, Y, g:i a" }}
    </p>

    <hr>

    <!-- Like Button -->
    <form action="{% url 'like_post' post.id %}" method="POST" class="mb-3">
      {% csrf_token %}
      <button type="submit" class="btn btn-outline-danger">
        ❤️ {{ post.total_likes }} Like{{ post.total_likes|pluralize }}
      </button>
    </form>

    <hr>

    <!-- Auto-view ad placeholder -->
    <div class="auto-ad" style="width:100%; height:100px; margin-bottom:10px; background-color:#f0f0f0; text-align:center; line-height:100px; color:#888;">
      Auto-view Ad Placeholder
    </div>

    <!-- Comments Section -->
    <h6>Comments</h6>
    <ul class="list-group list-group-flush mb-3">
      {% for comment in comments %}
        <li class="list-group-item">
          <strong>{{ comment.user.username }}:</strong> {{ comment.text }}
          <span class="text-muted small float-end">{{ comment.created_at|timesince }} ago</span>
        </li>
      {% empty %}
        <li class="list-group-item text-muted">No comments yet.</li>
      {% endfor %}
    </ul>

    <!-- Click-to-view ad placeholder -->
    <div class="click-ad" style="width:100%; height:100px; margin-bottom:10px; background-color:#e0e0ff; text-align:center; line-height:100px; color:#555; cursor:pointer;">
      Click-to-view Ad Placeholder
    </div>

    <!-- Add Comment Form -->
    <form action="{% url 'add_comment' post.id %}" method="POST">
      {% csrf_token %}
      <div class="input-group">
        <textarea name="text" class="form-control" placeholder="Add a comment..." required></textarea>
        <button type="submit" class="btn btn-primary">Comment</button>
      </div>
    </form>
  </div>
</div>

<!-- JS for click-to-view ad -->
<script>
document.querySelectorAll('.click-ad').forEach(ad => {
    ad.addEventListener('click', () => {
        alert('Ad clicked! Here you could redirect to advertiser or track clicks.');
        // Replace alert with real ad URL or tracking code
    });
});
</script>

{% endblock %}
